<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Cross-Border Shopping Assistant</title>
  <link rel="icon" href="data:,">
  <style>
    #bgVideo {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      object-fit: cover;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
    }

    header {
      margin-top: 30px;
      font-size: 2em;
      font-weight: bold;
    }

    .lang-switch {
      position: absolute;
      top: 20px;
      right: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 10;
    }

    .lang-switch button {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
    }

    .search-wrapper {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .search-wrapper input[type="text"] {
      padding: 18px;
      font-size: 18px;
      width: 540px;
      border-radius: 6px;
    }

    .search-wrapper button {
      padding: 18px 28px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 6px;
    }

    .main-row {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      width: 90%;
      margin-left: auto;
      margin-right: auto;
    }

    #searchResults {
      width: 60%;
      min-width: 480px;
      max-height: 60vh;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 16px;
      border-radius: 8px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 15px;
      line-height: 1.5;
      order: 2;
    }

    #keywordBox {
      width: 20%;
      min-width: 200px;
      max-height: 60vh;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 16px;
      border-radius: 8px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 15px;
      line-height: 1.5;
      order: 0;
    }

    .spacer {
      width: 10%;
      order: 1;
    }

    #keywordBox button.brand-button {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid white;
      margin: 6px 4px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: inline-block;
    }

    #keywordBox button.brand-button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    #keywordStatus {
      font-style: italic;
      margin-bottom: 10px;
      color: #ccc;
    }

    #keywordBox .product-series-section {
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.3);
    }

    #keywordBox .section-title {
      color: #ccc;
      font-size: 12px;
      margin-bottom: 8px;
      font-style: italic;
    }

    .purchase-links-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 2px solid rgba(255, 255, 255, 0.5);
    }

    .purchase-links-title {
      color: white;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 12px;
      text-align: left;
    }

    .purchase-links-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      max-width: 400px;
    }

    .purchase-link-button {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid white;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      transition: background-color 0.3s;
      text-align: center;
      display: block;
    }

    .purchase-link-button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* æ»šåŠ¨æ–‡å­—æ æ ·å¼ */
    .scrolling-text-container {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;  /* æ”¹ä¸ºå å±å¹•å®½åº¦çš„80% */
      max-width: 900px;  /* æœ€å¤§å®½åº¦é™åˆ¶ */
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 6px;
      padding: 12px 20px;
      overflow: hidden;
    }

    .scrolling-text {
      color: white;
      font-size: 16px;  /* ä»18pxå‡å°åˆ°16px */
      text-align: center;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .scrolling-text.active {
      opacity: 1;
    }

    /* å·¦ä¸‹è§’æŒ‰é’®æ ·å¼ */
    .bottom-left-buttons {
      position: fixed;
      bottom: 30px;
      left: 30px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .bottom-left-buttons button {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .bottom-left-buttons button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    /* æ¨¡æ€æ¡†é®ç½©å±‚ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    .modal-overlay.active {
      display: flex;
    }

    /* å¸®åŠ©å†…å®¹æ¡† */
    .help-modal {
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px;
      border-radius: 8px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .help-modal h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 24px;
    }

    /* åç‰‡å›¾ç‰‡æ¡† */
    .card-modal {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
    }

    .card-modal img {
      max-width: 100%;
      max-height: 90vh;
      border-radius: 8px;
    }

    /* å…³é—­æŒ‰é’® */
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      background-color: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s;
    }

    .modal-close:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>

<body>
  <video autoplay muted loop id="bgVideo">
    <source src="/video/websiteBackgroundVideo1.mp4" type="video/mp4">
  </video>

  <div class="lang-switch">
    <button onclick="switchLang('zh')">ä¸­æ–‡</button>
    <button onclick="switchLang('en')">English</button>
    <button onclick="switchLang('ru')">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
  </div>

  <header id="pageTitle">è·¨å¢ƒè´­ç‰©åŠ©æ‰‹</header>

  <div class="search-wrapper">
    <input type="text" id="searchInput" placeholder="è¾“å…¥æ‚¨æƒ³æœç´¢çš„å•†å“...">
    <button id="searchButton" onclick="performSearch()">æœç´¢</button>
  </div>

  <div class="main-row">
    <div id="keywordBox">
      <div id="keywordStatus">è¿™é‡Œä¼šæ˜¾ç¤ºä¸€äº›å…³é”®è¯</div>
    </div>
    <div class="spacer"></div>
    <div id="searchResults">è¿™é‡Œå°†æ˜¾ç¤ºæœç´¢ç»“æœ</div>
  </div>

  <!-- æ»šåŠ¨æ–‡å­—æ  -->
  <div class="scrolling-text-container">
    <div id="scrollingText" class="scrolling-text active"></div>
  </div>

  <!-- å·¦ä¸‹è§’æŒ‰é’® -->
  <div class="bottom-left-buttons">
    <button id="helpButton" onclick="showHelp()">å¸®åŠ©</button>
    <button id="authorButton" onclick="showAuthorCard()">ä½œè€…åç‰‡</button>
  </div>

  <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
  <div id="helpOverlay" class="modal-overlay" onclick="closeModal(event, 'helpOverlay')">
    <div class="help-modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal(event, 'helpOverlay')">Ã—</button>
      <h2 id="helpTitle">ä½¿ç”¨å¸®åŠ©</h2>
      <div id="helpContent"></div>
    </div>
  </div>

  <!-- ä½œè€…åç‰‡æ¨¡æ€æ¡† -->
  <div id="cardOverlay" class="modal-overlay" onclick="closeModal(event, 'cardOverlay')">
    <div class="card-modal" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeModal(event, 'cardOverlay')">Ã—</button>
      <img id="authorCardImage" src="" alt="Author Card">
    </div>
  </div>

  <!-- é…ç½®æ–‡ä»¶ -->
  <script src="/config.js"></script>

  <script>
    // æ£€æµ‹ç¯å¢ƒå¹¶è®¾ç½® API é…ç½®
    const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
    const API_BASE_URL = isProduction
      ? 'https://api.guishkakrasiviy.com'
      : (typeof CONFIG !== 'undefined' ? CONFIG.API_BASE_URL : 'http://127.0.0.1:8000');

    // APIè®¤è¯å¯†é’¥ - ä»é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡è¯»å–
    const API_KEY = typeof CONFIG !== 'undefined'
      ? CONFIG.API_KEY
      : "gsk-2025-secure-key-change-this";

    // åˆ›å»ºå¸¦è®¤è¯çš„è¯·æ±‚å¤´
    function getAuthHeaders() {
      return {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      };
    }

    const translations = {
      zh: {
        title: "è·¨å¢ƒè´­ç‰©åŠ©æ‰‹",
        placeholder: "è¾“å…¥æ‚¨æƒ³æœç´¢çš„å•†å“...",
        button: "æœç´¢",
        noInput: "è¯·è¾“å…¥æœç´¢å†…å®¹ã€‚",
        keywordPlaceholder: "è¿™é‡Œä¼šæ˜¾ç¤ºä¸€äº›å…³é”®è¯",
        resultPlaceholder: "è¿™é‡Œå°†æ˜¾ç¤ºæœç´¢ç»“æœ",
        keywordInstruction: "è¯·ç‚¹å‡»æ‚¨æ„Ÿå…´è¶£çš„è¯æ¡",
        searching: "æ­£åœ¨æœç´¢ï¼Œè¯·ç¨å€™...",
        brandSearching: "è¯·ç¨åï¼Œæ­£åœ¨ä¸ºæ‚¨æœç´¢",
        seriesLoading: "æ­£åœ¨åŠ è½½äº§å“ç³»åˆ—è¯¦æƒ…",
        purchaseTitle: "ğŸ›’ ä¿„ç½—æ–¯åŠå›½é™…ç”µå•†å¹³å°è´­ä¹°é“¾æ¥ï¼š",
        brandLoadError: "å“ç‰Œè¯¦æƒ…åŠ è½½å¤±è´¥ï¼š",
        seriesLoadError: "äº§å“ç³»åˆ—è¯¦æƒ…åŠ è½½å¤±è´¥ï¼š",
        brandDetailPrefix: "å“ç‰Œè¯¦æƒ…ï¼š",
        seriesDetailPrefix: "äº§å“ç³»åˆ—è¯¦æƒ…ï¼š",
        seriesSuffix: "ç³»åˆ—ï¼š",
        helpButton: "å¸®åŠ©",
        authorButton: "ä½œè€…åç‰‡"
      },
      en: {
        title: "Cross-border Shopping Assistant",
        placeholder: "Enter the product you want...",
        button: "Search",
        noInput: "Please enter a search term.",
        keywordPlaceholder: "Keywords will be displayed here",
        resultPlaceholder: "Search results will be displayed here",
        keywordInstruction: "Please click on the keyword you are interested in",
        searching: "Searching, please wait...",
        brandSearching: "Please wait, searching for you",
        seriesLoading: "Loading product series details",
        purchaseTitle: "ğŸ›’ Russian & International E-commerce Links:",
        brandLoadError: "Failed to load brand details: ",
        seriesLoadError: "Failed to load series details: ",
        brandDetailPrefix: "Brand Details:",
        seriesDetailPrefix: "Series Details:",
        seriesSuffix: "Series:",
        helpButton: "Help",
        authorButton: "Author Card"
      },
      ru: {
        title: "ĞÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº",
        placeholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ...",
        button: "ĞŸĞ¾Ğ¸ÑĞº",
        noInput: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ.",
        keywordPlaceholder: "Ğ—Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ñ‹ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°",
        resultPlaceholder: "Ğ—Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ°",
        keywordInstruction: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒÑÑ‰ĞµĞµ Ğ²Ğ°Ñ ÑĞ»Ğ¾Ğ²Ğ¾",
        searching: "Ğ˜Ğ´ĞµÑ‚ Ğ¿Ğ¾Ğ¸ÑĞº, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ...",
        brandSearching: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ, Ğ¸Ñ‰ĞµĞ¼ Ğ´Ğ»Ñ Ğ²Ğ°Ñ",
        seriesLoading: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ ÑĞµÑ€Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²",
        purchaseTitle: "ğŸ›’ Ğ¡ÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ»Ğ¾Ñ‰Ğ°Ğ´ĞºĞ¸:",
        brandLoadError: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±Ñ€ĞµĞ½Ğ´Ğµ: ",
        seriesLoadError: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞµÑ€Ğ¸Ğ¸: ",
        brandDetailPrefix: "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ±Ñ€ĞµĞ½Ğ´Ğµ:",
        seriesDetailPrefix: "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ ÑĞµÑ€Ğ¸Ğ¸:",
        seriesSuffix: "Ğ¡ĞµÑ€Ğ¸Ñ:",
        helpButton: "ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ",
        authorButton: "Ğ’Ğ¸Ğ·Ğ¸Ñ‚ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ°"
      }
    };

    let currentLang = "zh";
    let currentSearchQuery = ""; // ä¿å­˜å½“å‰æœç´¢çš„å•†å“ç±»å‹
    let scrollingTexts = {}; // å­˜å‚¨æ»šåŠ¨æ–‡æœ¬
    let currentTextIndex = 0; // å½“å‰æ˜¾ç¤ºçš„æ–‡æœ¬ç´¢å¼•
    let helpContent = {}; // å­˜å‚¨å¸®åŠ©å†…å®¹

    // åŠ è½½å¸®åŠ©å†…å®¹
    async function loadHelpContent() {
      try {
        const response = await fetch('/help_content.json');
        helpContent = await response.json();
      } catch (error) {
        console.error('Failed to load help content:', error);
        helpContent = {
          zh: { title: "ä½¿ç”¨å¸®åŠ©", content: "å¸®åŠ©å†…å®¹åŠ è½½å¤±è´¥" },
          en: { title: "Help", content: "Failed to load help content" },
          ru: { title: "ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ", content: "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ¿Ñ€Ğ°Ğ²ĞºÑƒ" }
        };
      }
    }

    // æ˜¾ç¤ºå¸®åŠ©
    function showHelp() {
      const content = helpContent[currentLang] || helpContent['zh'];
      document.getElementById('helpTitle').textContent = content.title;
      document.getElementById('helpContent').textContent = content.content;
      document.getElementById('helpOverlay').classList.add('active');
    }

    // æ˜¾ç¤ºä½œè€…åç‰‡
    function showAuthorCard() {
      const cardImage = document.getElementById('authorCardImage');
      // æ ¹æ®è¯­è¨€é€‰æ‹©ä¸åŒçš„å›¾ç‰‡
      const imagePath = `/images/author_card_${currentLang}.jpg`;
      cardImage.src = imagePath;
      cardImage.onerror = function() {
        // å¦‚æœå›¾ç‰‡ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å›¾ç‰‡
        this.src = '/images/author_card_default.jpg';
      };
      document.getElementById('cardOverlay').classList.add('active');
    }

    // å…³é—­æ¨¡æ€æ¡†
    function closeModal(event, modalId) {
      event.stopPropagation();
      document.getElementById(modalId).classList.remove('active');
    }

    // åŠ è½½æ»šåŠ¨æ–‡æœ¬
    async function loadScrollingTexts() {
      try {
        const response = await fetch('/scrolling_texts.json');
        scrollingTexts = await response.json();
        startScrollingText();
      } catch (error) {
        console.error('Failed to load scrolling texts:', error);
        // ä½¿ç”¨é»˜è®¤æ–‡æœ¬
        scrollingTexts = {
          zh: ["æ¬¢è¿ä½¿ç”¨è·¨å¢ƒè´­ç‰©åŠ©æ‰‹"],
          en: ["Welcome to Cross-border Shopping Assistant"],
          ru: ["Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº Ñ‚Ñ€Ğ°Ğ½ÑĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¿Ğ¾ĞºÑƒĞ¿Ğ¾Ğº"]
        };
        startScrollingText();
      }
    }

    // å¼€å§‹æ»šåŠ¨æ–‡æœ¬
    function startScrollingText() {
      updateScrollingText();
      setInterval(updateScrollingText, 5000); // æ¯5ç§’åˆ‡æ¢
    }

    // æ›´æ–°æ»šåŠ¨æ–‡æœ¬
    function updateScrollingText() {
      const texts = scrollingTexts[currentLang] || scrollingTexts['zh'];
      const scrollingElement = document.getElementById('scrollingText');

      // æ·¡å‡ºæ•ˆæœ
      scrollingElement.classList.remove('active');

      setTimeout(() => {
        // éšæœºé€‰æ‹©ä¸€ä¸ªä¸åŒçš„æ–‡æœ¬
        let newIndex;
        do {
          newIndex = Math.floor(Math.random() * texts.length);
        } while (newIndex === currentTextIndex && texts.length > 1);

        currentTextIndex = newIndex;

        // æ›´æ–°æ–‡æœ¬
        scrollingElement.textContent = texts[currentTextIndex];
        // æ·¡å…¥æ•ˆæœ
        scrollingElement.classList.add('active');
      }, 500);
    }

    function switchLang(lang) {
      currentLang = lang;
      const t = translations[lang];

      // æ›´æ–°æ‰€æœ‰UIæ–‡æœ¬
      document.getElementById("pageTitle").innerText = t.title;
      document.getElementById("searchInput").placeholder = t.placeholder;
      document.getElementById("searchButton").innerText = t.button;

      // æ›´æ–°å…³é”®è¯æ¡†å’Œç»“æœæ¡†çš„é»˜è®¤æ–‡æœ¬
      const keywordStatus = document.getElementById("keywordStatus");
      const searchResults = document.getElementById("searchResults");

      // åªæœ‰åœ¨æ˜¾ç¤ºé»˜è®¤æ–‡æœ¬æ—¶æ‰æ›´æ–°
      if (keywordStatus.innerText === translations.zh.keywordPlaceholder ||
          keywordStatus.innerText === translations.en.keywordPlaceholder ||
          keywordStatus.innerText === translations.ru.keywordPlaceholder) {
        keywordStatus.innerText = t.keywordPlaceholder;
      }

      if (searchResults.innerText === translations.zh.resultPlaceholder ||
          searchResults.innerText === translations.en.resultPlaceholder ||
          searchResults.innerText === translations.ru.resultPlaceholder) {
        searchResults.innerText = t.resultPlaceholder;
      }

      // ç«‹å³æ›´æ–°æ»šåŠ¨æ–‡æœ¬ï¼ˆä¿æŒéšæœºæ€§ï¼‰
      updateScrollingText();

      // æ›´æ–°å·¦ä¸‹è§’æŒ‰é’®æ–‡æœ¬
      document.getElementById('helpButton').textContent = t.helpButton;
      document.getElementById('authorButton').textContent = t.authorButton;
    }

    async function performSearch() {
      const input = document.getElementById("searchInput").value;
      const results = document.getElementById("searchResults");
      const keywordBox = document.getElementById("keywordBox");
      const keywordStatus = document.getElementById("keywordStatus");

      if (input.trim() === "") {
        results.innerText = translations[currentLang].noInput;
        return;
      }

      results.innerText = "";
      keywordBox.innerHTML = `<div id="keywordStatus">${translations[currentLang].searching}</div>`;

      currentSearchQuery = input;

      try {
        const response = await fetch(`${API_BASE_URL}/search-stream`, {
          method: "POST",
          headers: getAuthHeaders(),
          body: JSON.stringify({
            query: input,
            language: currentLang
          })
        });

        if (!response.ok) throw new Error("æœåŠ¡å™¨å“åº”é”™è¯¯ï¼");

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let fullContent = '';

        while (true) {
          const { done, value } = await reader.read();
          if (done) break;

          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split('\n');
          buffer = lines.pop() || '';

          for (const line of lines) {
            if (line.startsWith('data: ')) {
              try {
                const data = JSON.parse(line.slice(6));
                if (data.content) {
                  results.innerText += data.content;
                  fullContent += data.content;
                }
                if (data.done) {
                  parseAndDisplayBrands(fullContent, keywordBox);
                }
              } catch (e) {
                console.error('Parse error:', e);
              }
            }
          }
        }
      } catch (err) {
        console.error('Search error:', err);
        results.innerText = translations[currentLang].noInput + ": " + err.message;
      }
    }

    function parseAndDisplayBrands(content, keywordBox) {
      const lines = content.split("\n");

      const brandLines = lines.filter(line => {
        const trimmed = line.trim();
        return trimmed.startsWith("ğŸ‘‰ ") || trimmed.startsWith("ğŸ‘‰");
      });

      const brands = brandLines.map(line => {
        return line.trim().replace(/^ğŸ‘‰\s*/, "").trim();
      });

      const keywordStatus = document.getElementById("keywordStatus");
      keywordStatus.innerText = brands.length > 0 ? translations[currentLang].keywordInstruction : translations[currentLang].keywordPlaceholder;

      brands.forEach(brand => {
        const btn = document.createElement("button");
        btn.innerText = brand;
        btn.classList.add("brand-button");
        btn.onclick = async () => {
          document.getElementById("keywordStatus").innerText = translations[currentLang].brandSearching;
          try {
            const apiUrl = currentSearchQuery
              ? "http://127.0.0.1:8000/brand-detail-with-context-stream"
              : "http://127.0.0.1:8000/brand-detail-stream";

            const requestBody = currentSearchQuery
              ? { brand: brand, context: currentSearchQuery, language: currentLang }
              : { brand: brand, language: currentLang };

            const res = await fetch(apiUrl, {
              method: "POST",
              headers: getAuthHeaders(),
              body: JSON.stringify(requestBody)
            });

            if (!res.ok) throw new Error("æœåŠ¡å™¨é”™è¯¯ï¼");

            // åˆ›å»ºå“ç‰Œå†…å®¹å®¹å™¨
            const brandContent = document.createElement('div');
            brandContent.style.whiteSpace = 'pre-wrap';
            brandContent.textContent = `\n\nğŸ“Œ ${brand} ${translations[currentLang].brandDetailPrefix}\n`;
            document.getElementById("searchResults").appendChild(brandContent);

            // æµå¼è¯»å–å“åº”
            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            let buffer = '';
            let fullContent = '';

            while (true) {
              const { done, value } = await reader.read();
              if (done) break;

              buffer += decoder.decode(value, { stream: true });
              const lines = buffer.split('\n');
              buffer = lines.pop() || '';

              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  try {
                    const data = JSON.parse(line.slice(6));
                    if (data.content) {
                      brandContent.textContent += data.content;
                      fullContent += data.content;
                    }
                    if (data.done) {
                      // æµå¼è¾“å‡ºå®Œæˆï¼Œè§£æäº§å“ç³»åˆ—
                      parseBrandSeries(fullContent, brand);
                    }
                  } catch (e) {
                    console.error('Parse error:', e);
                  }
                }
              }
            }

            document.getElementById("keywordStatus").innerText = translations[currentLang].keywordInstruction;
          } catch (err) {
            alert(translations[currentLang].brandLoadError + err.message);
            document.getElementById("keywordStatus").innerText = translations[currentLang].keywordInstruction;
          }
        };
        keywordBox.appendChild(btn);
      });
    }

    // è§£æå“ç‰Œå†…å®¹ä¸­çš„äº§å“ç³»åˆ—
    function parseBrandSeries(content, brand) {
      const productLines = content.split("\n");
      const series = [];

      productLines.forEach(line => {
        const trimmedLine = line.trim();

        if (trimmedLine.startsWith("â—†â—†â—† ")) {
          let seriesName = trimmedLine.replace("â—†â—†â—† ", "").trim();
          seriesName = seriesName.replace(/\*+([^*]+)\*+/g, '$1');

          // å¤„ç†åŒ…å«æ‹¬å·æè¿°çš„æƒ…å†µï¼Œå¦‚ "Find Series" (Flagship lineup...)
          const nameWithDescMatch = seriesName.match(/^"?([^"(]+)"?\s*\(/);
          if (nameWithDescMatch) {
            seriesName = nameWithDescMatch[1].trim();
          } else {
            // åŸæœ‰çš„å¤„ç†é€»è¾‘
            const englishMatch = seriesName.match(/[ï¼ˆ(]([A-Za-z\s\-]+)[ï¼‰)]/);
            if (currentLang !== "zh" && englishMatch) {
              seriesName = englishMatch[1].trim();
            } else if (currentLang !== "zh") {
              const pureEnglishMatch = seriesName.match(/([A-Za-z\s\-]+)/);
              if (pureEnglishMatch) {
                seriesName = pureEnglishMatch[1].trim();
              }
            }
          }
          series.push(seriesName);
        }
        else if (trimmedLine.startsWith("ğŸ”¸ ")) {
          let seriesName = trimmedLine.replace("ğŸ”¸ ", "").trim();
          seriesName = seriesName.replace(/\*+([^*]+)\*+/g, '$1');

          // å¤„ç†åŒ…å«æ‹¬å·æè¿°çš„æƒ…å†µ
          const nameWithDescMatch = seriesName.match(/^"?([^"(]+)"?\s*\(/);
          if (nameWithDescMatch) {
            seriesName = nameWithDescMatch[1].trim();
          } else {
            // åŸæœ‰çš„å¤„ç†é€»è¾‘
            const englishMatch = seriesName.match(/[ï¼ˆ(]([A-Za-z\s\-]+)[ï¼‰)]/);
            if (currentLang !== "zh" && englishMatch) {
              seriesName = englishMatch[1].trim();
            } else if (currentLang !== "zh") {
              const pureEnglishMatch = seriesName.match(/([A-Za-z\s\-]+)/);
              if (pureEnglishMatch) {
                seriesName = pureEnglishMatch[1].trim();
              }
            }
          }
          series.push(seriesName);
        }
      });

      if (series.length > 0) {
        const keywordBox = document.getElementById("keywordBox");
        const seriesSection = document.createElement("div");
        seriesSection.classList.add("product-series-section");

        const sectionTitle = document.createElement("div");
        sectionTitle.classList.add("section-title");
        sectionTitle.innerText = currentSearchQuery
          ? `${brand} ${currentSearchQuery}${translations[currentLang].seriesSuffix}`
          : `${brand} ${translations[currentLang].seriesSuffix}`;
        seriesSection.appendChild(sectionTitle);

        series.forEach(seriesName => {
          const seriesBtn = document.createElement("button");
          seriesBtn.innerText = seriesName;
          seriesBtn.classList.add("brand-button");
          seriesBtn.onclick = async () => {
            document.getElementById("keywordStatus").innerText = translations[currentLang].seriesLoading;
            try {
              const apiUrl = currentSearchQuery
                ? "http://127.0.0.1:8000/product-detail-with-context-stream"
                : "http://127.0.0.1:8000/product-detail-stream";

              const requestBody = currentSearchQuery
                ? { brand: `${brand} ${seriesName}`, context: currentSearchQuery, language: currentLang }
                : { brand: `${brand} ${seriesName}`, language: currentLang };

              const seriesRes = await fetch(apiUrl, {
                method: "POST",
                headers: getAuthHeaders(),
                body: JSON.stringify(requestBody)
              });

              if (!seriesRes.ok) throw new Error("æœåŠ¡å™¨é”™è¯¯ï¼");

              // åˆ›å»ºäº§å“ç³»åˆ—å†…å®¹å®¹å™¨
              const newContent = document.createElement('div');
              newContent.style.whiteSpace = 'pre-wrap';
              newContent.textContent = `\n\nğŸ”¹ ${seriesName} ${translations[currentLang].seriesDetailPrefix}\n`;
              document.getElementById("searchResults").appendChild(newContent);

              // æµå¼è¯»å–å“åº”
              const reader = seriesRes.body.getReader();
              const decoder = new TextDecoder();
              let buffer = '';
              let seriesFullContent = '';

              while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                buffer += decoder.decode(value, { stream: true });
                const lines = buffer.split('\n');
                buffer = lines.pop() || '';

                for (const line of lines) {
                  if (line.startsWith('data: ')) {
                    try {
                      const data = JSON.parse(line.slice(6));
                      if (data.content) {
                        newContent.textContent += data.content;
                        seriesFullContent += data.content;
                      }
                      if (data.done) {
                        // æµå¼è¾“å‡ºå®Œæˆï¼Œç”Ÿæˆè´­ä¹°é“¾æ¥
                        generatePurchaseLinks(brand, seriesName);
                      }
                    } catch (e) {
                      console.error('Parse error:', e);
                    }
                  }
                }
              }

              document.getElementById("keywordStatus").innerText = translations[currentLang].keywordInstruction;
            } catch (err) {
              alert(translations[currentLang].seriesLoadError + err.message);
              document.getElementById("keywordStatus").innerText = translations[currentLang].keywordInstruction;
            }
          };
          seriesSection.appendChild(seriesBtn);
        });

        keywordBox.appendChild(seriesSection);
      }
    }

    // ç”Ÿæˆè´­ä¹°é“¾æ¥
    async function generatePurchaseLinks(brand, seriesName) {
      try {
        const keywordRes = await fetch("http://127.0.0.1:8000/generate-keyword", {
          method: "POST",
          headers: getAuthHeaders(),
          body: JSON.stringify({
            brand: brand,
            series: seriesName,
            category: currentSearchQuery,
            language: currentLang
          })
        });

        let searchKeyword = `${brand} ${seriesName}`;
        if (keywordRes.ok) {
          const keywordData = await keywordRes.json();
          searchKeyword = keywordData.keyword;
        }

        const purchaseLinksHtml = `
          <div class="purchase-links-section">
            <div class="purchase-links-title">${translations[currentLang].purchaseTitle}</div>
            <div class="purchase-links-grid">
              <a href="https://www.ozon.ru/search/?text=${encodeURIComponent(searchKeyword)}"
                 target="_blank" class="purchase-link-button">
                Ozon.ru
              </a>
              <a href="https://www.wildberries.ru/catalog/0/search.aspx?search=${encodeURIComponent(searchKeyword)}"
                 target="_blank" class="purchase-link-button">
                Wildberries
              </a>
              <a href="https://market.yandex.ru/search?text=${encodeURIComponent(searchKeyword)}"
                 target="_blank" class="purchase-link-button">
                Yandex.Market
              </a>
              <a href="https://www.alibaba.com/trade/search?SearchText=${encodeURIComponent(searchKeyword)}"
                 target="_blank" class="purchase-link-button">
                Alibaba
              </a>
            </div>
          </div>
        `;

        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = purchaseLinksHtml;
        document.getElementById("searchResults").appendChild(tempDiv.firstElementChild);
      } catch (err) {
        console.error('Error generating purchase links:', err);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("searchInput").addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          performSearch();
        }
      });
      switchLang(currentLang);

      document.getElementById("keywordStatus").innerText = translations[currentLang].keywordPlaceholder;
      document.getElementById("searchResults").innerText = translations[currentLang].resultPlaceholder;

      // åŠ è½½æ»šåŠ¨æ–‡æœ¬
      loadScrollingTexts();

      // åŠ è½½å¸®åŠ©å†…å®¹
      loadHelpContent();
    });
  </script>
</body>

</html>